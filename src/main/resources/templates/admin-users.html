<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ ‚Äì EventApp</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
        .users-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        @media (min-width: 640px) {
            .users-grid {
                grid-template-columns: repeat(auto-fill, minmax(480px, 1fr));
            }
        }
        .user-card {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            flex-wrap: wrap;
        }
        .user-info-section {
            flex: 1;
            min-width: 200px;
        }
        .user-actions-section {
            min-width: 220px;
            max-width: 280px;
            flex-shrink: 0;
        }
        @media (max-width: 639px) {
            .user-actions-section {
                width: 100%;
                max-width: 100%;
            }
        }
        .role-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .role-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            font-size: 0.9em;
        }
        .role-select:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(43, 214, 123, 0.18);
        }
    </style>
</head>
<body class="landing">
<header class="landing-header">
    <div class="container topbar">
        <a class="brand" th:href="@{/}">EventApp</a>
        <nav class="nav">
            <a class="nav-link" th:href="@{/home}">–¢–∞–±–ª–æ</a>
            <a class="nav-link" th:href="@{/events}">–°—ä–±–∏—Ç–∏—è</a>
            <a class="nav-link" th:href="@{/events/create}">–ù–æ–≤–æ —Å—ä–±–∏—Ç–∏–µ</a>
            <a class="nav-link" sec:authorize="hasRole('ADMIN')" th:href="@{/admin/categories}">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
            <a class="nav-link" sec:authorize="hasRole('ADMIN')" th:href="@{/admin/users}">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a>
            <a class="nav-link" th:href="@{/logout}">–ò–∑—Ö–æ–¥</a>
            <button id="themeToggle" class="icon-btn" aria-label="–ü—Ä–µ–≤–∫–ª—é—á–∏ —Ç–µ–º–∞">üåì</button>
        </nav>
    </div>
</header>

<main>
    <section class="hero slim-hero">
        <div class="container hero-inner">
            <h1 class="hero-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h1>
            <p class="hero-subtitle">–ü—Ä–µ–≥–ª–µ–∂–¥–∞–π –∏ —É–ø—Ä–∞–≤–ª—è–≤–∞–π —Ä–æ–ª–∏—Ç–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞.</p>
        </div>
        <div class="hero-bg"></div>
    </section>

    <div class="container">
        <div class="card" th:if="${param.success}">
            <strong>–ì–æ—Ç–æ–≤–æ!</strong> –†–æ–ª—è—Ç–∞ –±–µ—à–µ –ø—Ä–æ–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.
        </div>

        <div class="card" th:if="${param.error == 'alreadyHasRole'}">
            <strong>–ì—Ä–µ—à–∫–∞:</strong> –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –≤–µ—á–µ –∏–º–∞ —Ç–∞–∑–∏ —Ä–æ–ª—è.
        </div>

        <div class="card" th:if="${param.error == 'invalidRole'}">
            <strong>–ì—Ä–µ—à–∫–∞:</strong> –ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Ä–æ–ª—è.
        </div>

        <div class="card" th:if="${param.error == 'notFound'}">
            <strong>–ì—Ä–µ—à–∫–∞:</strong> –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω.
        </div>

        <div class="card">
            <h2 class="mt-0">–í—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h2>
            <div th:if="${#lists.isEmpty(users)}">
                <p>–í—Å–µ –æ—â–µ –Ω—è–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.</p>
            </div>
            <div class="users-grid" th:if="${!#lists.isEmpty(users)}">
                <article class="feature-card" th:each="user : ${users}">
                    <div class="user-card">
                        <div class="user-info-section">
                            <h3 style="margin: 0 0 12px 0;" th:text="${user.username}">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ</h3>
                            <div class="meta" style="margin-top: 0;">
                                <div style="margin-bottom: 10px;">
                                    <strong>Email:</strong> 
                                    <span th:text="${user.email}">email@example.com</span>
                                </div>
                                <div th:if="${user.firstName != null || user.lastName != null}" style="margin-bottom: 10px;">
                                    <strong>–ò–º–µ:</strong>
                                    <span th:text="${(user.firstName != null ? user.firstName : '') + (user.lastName != null ? ' ' + user.lastName : '')}">-</span>
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <strong>–¢–µ–∫—É—â–∞ —Ä–æ–ª—è:</strong> 
                                    <span class="badge" 
                                          style="display: inline-block; padding: 4px 10px; border-radius: 6px; margin-left: 8px; font-size: 0.85em; font-weight: 600;"
                                          th:styleappend="${user.role.name() == 'ADMIN'} ? 'background: var(--brand); color: #fff;' : 'background: var(--border); color: var(--text);'"
                                          th:text="${user.role.name()}">
                                        USER
                                    </span>
                                </div>
                                <div style="font-size: 0.875em; color: var(--muted);">
                                    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω: <span th:text="${#temporals.format(user.createdOn, 'dd.MM.yyyy HH:mm')}">...</span>
                                </div>
                            </div>
                        </div>
                        <div class="user-actions-section">
                            <form th:action="@{/admin/users/{id}/role(id=${user.id})}" 
                                  method="post"
                                  class="role-form">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <div>
                                    <label th:for="'role-' + ${user.id}" style="display: block; margin-bottom: 6px; font-size: 0.875em; font-weight: 600; color: var(--text);">
                                        –ü—Ä–æ–º–µ–Ω–∏ —Ä–æ–ª—è:
                                    </label>
                                    <select th:id="'role-' + ${user.id}"
                                            name="role" 
                                            class="role-select">
                                        <option th:each="role : ${roles}" 
                                                th:value="${role.name()}" 
                                                th:text="${role.name()}"
                                                th:selected="${user.role == role}">
                                            USER
                                        </option>
                                    </select>
                                </div>
                                <button type="submit" 
                                        class="btn btn-primary"
                                        style="width: 100%; padding: 10px 16px; font-size: 0.9em; white-space: nowrap;">
                                    –ü—Ä–æ–º–µ–Ω–∏ —Ä–æ–ª—è
                                </button>
                            </form>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </div>
</main>

<th:block th:replace="~{fragments/footer :: siteFooter}"></th:block>

<script>
    (function theme(){
        const btn = document.getElementById('themeToggle');
        if(!btn) return;
        const key = 'eventapp-theme';
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const saved = localStorage.getItem(key);
        const apply = (m)=>{ document.documentElement.dataset.theme = m; localStorage.setItem(key,m); };
        apply(saved || (prefersDark ? 'dark' : 'light'));
        btn.addEventListener('click', ()=> apply(document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark'));
    })();
</script>
</body>
</html>

